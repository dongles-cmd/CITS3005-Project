{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center">Add a New Procedure</h2>
    <form id="addProcedureForm" action="/add-procedure" method="POST">
        <div class="row">
            <!-- Procedure URL -->
            <div class="col-md-6 mb-3">
                <label for="url">Procedure URL</label>
                <input type="text" class="form-control" id="url" name="url" placeholder="Enter procedure URL" required>
            </div>

            <!-- Procedure Title -->
            <div class="col-md-6 mb-3">
                <label for="title">Procedure Title</label>
                <input type="text" class="form-control" id="title" name="Title" placeholder="Enter procedure title" required>
            </div>
        </div>

        <div class="row">
            <!-- Category (Item) -->
            <div class="col-md-6 mb-3">
                <label for="category">Item Category</label>
                <input type="text" class="form-control" id="category" name="Category" placeholder="Enter item category" required>
            </div>

            <!-- Subject (Part) -->
            <div class="col-md-6 mb-3">
                <label for="subject">Subject</label>
                <input type="text" class="form-control" id="subject" name="Subject" placeholder="Enter subject" required>
            </div>
        </div>

        <!-- Toolbox (Tools) -->
        <div id="toolboxContainer" class="form-group mb-4">
            <label for="toolbox">Toolbox (Tools)</label>
            <div class="toolbox-group">
                <input type="text" class="form-control mb-2" name="Toolbox[0][Name]" placeholder="Enter tool name" required>
                <input type="text" class="form-control mb-2" name="Toolbox[0][Url]" placeholder="Enter tool URL (optional)">
            </div>
            <button type="button" class="btn btn-secondary mb-3" onclick="addTool()">Add another tool</button>
        </div>

        <!-- Steps -->
        <div id="stepsContainer" class="form-group mb-4">
            <label for="steps">Steps</label>
            <div class="step-group mb-3">
                <input type="text" class="form-control mb-2" name="Steps[0][StepId]" placeholder="Step ID" required>
                <textarea class="form-control mb-2" name="Steps[0][Text_raw]" placeholder="Step description" required></textarea>
                <input type="text" class="form-control mb-2" name="Steps[0][Images]" placeholder="Comma-separated image URLs">
                <input type="text" class="form-control mb-2" name="Steps[0][Tools_extracted]" placeholder="Comma-separated tool names">
            </div>
            <button type="button" class="btn btn-secondary mb-3" onclick="addStep()">Add another step</button>
        </div>

        <!-- Submit button -->
        <button type="submit" class="btn btn-primary mt-3">Submit Procedure</button>
    </form>
</div>

<script>
    let toolCount = 1;
    let stepCount = 1;

    function addTool() {
        const toolboxContainer = document.getElementById('toolboxContainer');
        const newTool = document.createElement('div');
        newTool.classList.add('toolbox-group', 'mb-2');
        newTool.innerHTML = `
            <input type="text" class="form-control mb-2" name="Toolbox[${toolCount}][Name]" placeholder="Enter tool name" required>
            <input type="text" class="form-control mb-2" name="Toolbox[${toolCount}][Url]" placeholder="Enter tool URL (optional)">
        `;
        toolboxContainer.appendChild(newTool);
        toolCount++;
    }

    function addStep() {
        const stepsContainer = document.getElementById('stepsContainer');
        const newStep = document.createElement('div');
        newStep.classList.add('step-group', 'mb-3');
        newStep.innerHTML = `
            <input type="text" class="form-control mb-2" name="Steps[${stepCount}][StepId]" placeholder="Step ID" required>
            <textarea class="form-control mb-2" name="Steps[${stepCount}][Text_raw]" placeholder="Step description" required></textarea>
            <input type="text" class="form-control mb-2" name="Steps[${stepCount}][Images]" placeholder="Comma-separated image URLs">
            <input type="text" class="form-control mb-2" name="Steps[${stepCount}][Tools_extracted]" placeholder="Comma-separated tool names">
        `;
        stepsContainer.appendChild(newStep);
        stepCount++;
    }
</script>
{% endblock %}
