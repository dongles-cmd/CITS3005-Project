{% extends "base.html" %}

{% block content %}
<div class="container">
    <h2>Add a New Procedure</h2>
    <form id="addProcedureForm" action="/add-procedure" method="POST">
        <!-- Procedure URL -->
        <div class="form-group">
            <label for="url">Procedure URL</label>
            <input type="text" class="form-control" id="url" name="url" placeholder="Enter procedure URL" required>
        </div>

        <!-- Procedure Title -->
        <div class="form-group">
            <label for="title">Procedure Title</label>
            <input type="text" class="form-control" id="title" name="Title" placeholder="Enter procedure title" required>
        </div>

        <!-- Category (Item) -->
        <div class="form-group">
            <label for="category">Item Category</label>
            <input type="text" class="form-control" id="category" name="Category" placeholder="Enter item category" required>
        </div>

        <!-- Subject (Part) -->
        <div class="form-group">
            <label for="subject">Subject</label>
            <input type="text" class="form-control" id="subject" name="Subject" placeholder="Enter subject" required>
        </div>

        <!-- Toolbox (Tools) -->
        <div id="toolboxContainer" class="form-group">
            <label for="toolbox">Toolbox (Tools)</label>
            <div class="toolbox-group">
                <input type="text" class="form-control" name="Toolbox[0][Name]" placeholder="Enter tool name" required>
                <input type="text" class="form-control" name="Toolbox[0][Url]" placeholder="Enter tool URL (optional)">
            </div>
        </div>
        <button type="button" class="btn btn-secondary" onclick="addTool()">Add another tool</button>

        <!-- Steps -->
        <div id="stepsContainer" class="form-group">
            <label for="steps">Steps</label>
            <div class="step-group">
                <input type="text" class="form-control" name="Steps[0][StepId]" placeholder="Step ID" required>
                <textarea class="form-control" name="Steps[0][Text_raw]" placeholder="Step description" required></textarea>
                <input type="text" class="form-control" name="Steps[0][Images]" placeholder="Comma-separated image URLs">
                <input type="text" class="form-control" name="Steps[0][Tools_extracted]" placeholder="Comma-separated tool names">
            </div>
        </div>
        <button type="button" class="btn btn-secondary" onclick="addStep()">Add another step</button>

        <!-- Submit button -->
        <button type="submit" class="btn btn-primary mt-3">Submit Procedure</button>
    </form>
</div>

<script>
    let toolCount = 1;
    let stepCount = 1;

    function addTool() {
        const toolboxContainer = document.getElementById('toolboxContainer');
        const newTool = document.createElement('div');
        newTool.classList.add('toolbox-group');
        newTool.innerHTML = `
            <input type="text" class="form-control" name="Toolbox[${toolCount}][Name]" placeholder="Enter tool name" required>
            <input type="text" class="form-control" name="Toolbox[${toolCount}][Url]" placeholder="Enter tool URL (optional)">
        `;
        toolboxContainer.appendChild(newTool);
        toolCount++;
    }

    function addStep() {
        const stepsContainer = document.getElementById('stepsContainer');
        const newStep = document.createElement('div');
        newStep.classList.add('step-group');
        newStep.innerHTML = `
            <input type="text" class="form-control" name="Steps[${stepCount}][StepId]" placeholder="Step ID" required>
            <textarea class="form-control" name="Steps[${stepCount}][Text_raw]" placeholder="Step description" required></textarea>
            <input type="text" class="form-control" name="Steps[${stepCount}][Images]" placeholder="Comma-separated image URLs">
            <input type="text" class="form-control" name="Steps[${stepCount}][Tools_extracted]" placeholder="Comma-separated tool names">
        `;
        stepsContainer.appendChild(newStep);
        stepCount++;
    }
</script>
{% endblock %}
